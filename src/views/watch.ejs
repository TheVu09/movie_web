<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= movie.title %> - Where to Watch
    </title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>

<body class="bg-dark">
    <%- include('partials/navbar') %>

        <div class="container my-5">
            <div class="card bg-gradient border-0 shadow-lg">
                <div class="card-body p-4 p-md-5">
                    <h2 class="card-title text-center mb-4 display-5 fw-bold">
                        Where to Watch
                    </h2>

                    <% if (movie.providers) { %>

                        <% if (movie.providers.flatrate && movie.providers.flatrate.length> 0) { %>
                            <div class="mb-4">
                                <h3 class="h4 text-success mb-3">
                                    <i class="bi bi-play-circle-fill"></i> Streaming
                                </h3>
                                <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                                    <% movie.providers.flatrate.forEach(p=> { %>
                                        <div class="col">
                                            <a href="<%= movie.providers.link %>" target="_blank"
                                                class="text-decoration-none">
                                                <div class="card bg-secondary h-100 text-center shadow-sm"
                                                    style="cursor: pointer; transition: transform 0.2s;"
                                                    onmouseover="this.style.transform='scale(1.05)'"
                                                    onmouseout="this.style.transform='scale(1)'">
                                                    <div
                                                        class="card-body d-flex flex-column align-items-center justify-content-center p-3">
                                                        <% if (p.logo_path) { %>
                                                            <img src="https://image.tmdb.org/t/p/original<%= p.logo_path %>"
                                                                alt="<%= p.provider_name %>"
                                                                class="rounded mb-2 shadow-sm"
                                                                style="width: 60px; height: 60px; object-fit: cover;">
                                                            <% } %>
                                                                <p class="card-text small fw-semibold mb-0 text-white">
                                                                    <%= p.provider_name %>
                                                                </p>
                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                        <% }) %>
                                </div>
                            </div>
                            <% } %>

                                <% if (movie.providers.rent && movie.providers.rent.length> 0) { %>
                                    <div class="mb-4">
                                        <h3 class="h4 text-warning mb-3">
                                            <i class="bi bi-cash-coin"></i> Rent
                                        </h3>
                                        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                                            <% movie.providers.rent.forEach(p=> { %>
                                                <div class="col">
                                                    <a href="<%= movie.providers.link %>" target="_blank"
                                                        class="text-decoration-none">
                                                        <div class="card bg-secondary h-100 text-center shadow-sm"
                                                            style="cursor: pointer; transition: transform 0.2s;"
                                                            onmouseover="this.style.transform='scale(1.05)'"
                                                            onmouseout="this.style.transform='scale(1)'">
                                                            <div
                                                                class="card-body d-flex flex-column align-items-center justify-content-center p-3">
                                                                <% if (p.logo_path) { %>
                                                                    <img src="https://image.tmdb.org/t/p/original<%= p.logo_path %>"
                                                                        alt="<%= p.provider_name %>"
                                                                        class="rounded mb-2 shadow-sm"
                                                                        style="width: 60px; height: 60px; object-fit: cover;">
                                                                    <% } %>
                                                                        <p
                                                                            class="card-text small fw-semibold mb-0 text-white">
                                                                            <%= p.provider_name %>
                                                                        </p>
                                                            </div>
                                                        </div>
                                                    </a>
                                                </div>
                                                <% }) %>
                                        </div>
                                    </div>
                                    <% } %>

                                        <% if (movie.providers.buy && movie.providers.buy.length> 0) { %>
                                            <div class="mb-4">
                                                <h3 class="h4 text-danger mb-3">
                                                    <i class="bi bi-cart-fill"></i> Buy
                                                </h3>
                                                <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-3">
                                                    <% movie.providers.buy.forEach(p=> { %>
                                                        <div class="col">
                                                            <a href="<%= movie.providers.link %>" target="_blank"
                                                                class="text-decoration-none">
                                                                <div class="card bg-secondary h-100 text-center shadow-sm"
                                                                    style="cursor: pointer; transition: transform 0.2s;"
                                                                    onmouseover="this.style.transform='scale(1.05)'"
                                                                    onmouseout="this.style.transform='scale(1)'">
                                                                    <div
                                                                        class="card-body d-flex flex-column align-items-center justify-content-center p-3">
                                                                        <% if (p.logo_path) { %>
                                                                            <img src="https://image.tmdb.org/t/p/original<%= p.logo_path %>"
                                                                                alt="<%= p.provider_name %>"
                                                                                class="rounded mb-2 shadow-sm"
                                                                                style="width: 60px; height: 60px; object-fit: cover;">
                                                                            <% } %>
                                                                                <p
                                                                                    class="card-text small fw-semibold mb-0 text-white">
                                                                                    <%= p.provider_name %>
                                                                                </p>
                                                                    </div>
                                                                </div>
                                                            </a>
                                                        </div>
                                                        <% }) %>
                                                </div>
                                            </div>
                                            <% } %>

                                                <div class="text-center mt-4">
                                                    <a href="<%= movie.providers.link %>" target="_blank"
                                                        class="btn btn-primary btn-lg rounded-pill shadow">
                                                        <i class="bi bi-box-arrow-up-right"></i> View on JustWatch
                                                    </a>
                                                </div>

                                                <% } else { %>
                                                    <div class="alert alert-secondary text-center py-5" role="alert">
                                                        <h1 class="display-1">ðŸ˜¢</h1>
                                                        <p class="fs-5 mb-0">No provider information available</p>
                                                    </div>
                                                    <% } %>
                </div>
            </div>

            <div class="mt-4 mb-5">
                <a href="/movie/<%= movie.id %>" class="btn btn-outline-light">
                    <i class="bi bi-arrow-left"></i> Back to Movie Details
                </a>
            </div>
        </div>

        <%- include('partials/footer') %>

            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>